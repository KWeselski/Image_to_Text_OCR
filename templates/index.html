<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>OCR</title>
    <link rel="stylesheet" href="{{ url_for('static', filename='style.css')}}">
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap@4.5.3/dist/css/bootstrap.min.css" integrity="sha384-TX8t27EcRE3e/ihU7zmQxVncDAy5uIKz4rEkgIXeMed4M0jlfIDPvg6uqKI2xXr2" crossorigin="anonymous">
</head>
<body>
    <div>
        <script src="https://code.jquery.com/jquery-3.5.1.slim.min.js" integrity="sha384-DfXdz2htPH0lsSSs5nCTpuj/zy4C+OGpamoFVy38MVBnE+IbbVYUew+OrCXaRkfj" crossorigin="anonymous"></script>
        <script src="https://cdn.jsdelivr.net/npm/bootstrap@4.5.3/dist/js/bootstrap.bundle.min.js" integrity="sha384-ho+j7jyWK8fNQe+A12Hb8AhRq26LrZ/JpcUGGOn+Y7RsweNrtN/tE3MoK7ZeZDyx" crossorigin="anonymous"></script>
        <h1>Scan Image</h1>
        <div class="inputoutput">
          <img id="imageSrc" alt="No Image" />
          <div class="caption">imageSrc <input type="file" id="fileInput" name="file" /></div>
        </div>
        <div class="inputoutput">
          <canvas id="canvasOutput" ></canvas>
          <div class="caption">canvasOutput</div>
        </div>
    </div>
    <div>
      <button onclick="changeToGray()">Change to Gray</button>
    </div>
    <div>
      Treshold: <input type="range" id="trackbar" value="50" min="0" max="255" step="1" oninput="callback()">
      <input type="text" id="weightValue" size="3" value="50"/>
    </div>
    <div>
      <button onclick="thresholding()">Tresholding</button>
    </div>

    
<script type="text/javascript">
    let imgElement = document.getElementById('imageSrc');
    let inputElement = document.getElementById('fileInput');
    inputElement.addEventListener('change', (e) => {
      imgElement.src = URL.createObjectURL(e.target.files[0]);
    }, false);

    let x = document.createElement('INPUT');
    x.setAttribute('type','range');

   
    imgElement.onload = function() {
      let mat = cv.imread(imgElement);
      cv.imshow('canvasOutput', mat);
      mat.delete();
    };
    function onOpenCvReady() {
      document.getElementById('status').innerHTML = 'OpenCV.js is ready.';
    }
    function changeToGray() {  
      let src = cv.imread('imageSrc');
      let dst = new cv.Mat(); 
      cv.cvtColor(src, dst, cv.COLOR_RGBA2GRAY);
      cv.imshow('canvasOutput', dst);
      src.delete();dst.delete(); 
    };
 
    function thresholding() {
      let src = cv.imread('imageSrc');
      let dst = new cv.Mat();
      let weightValue = document.getElementById('weightValue');
      let value = weightValue.getAttribute('value');
      cv.threshold(src, dst,parseInt(value), 255, cv.THRESH_BINARY);
      cv.imshow('canvasOutput', dst);
      src.delete();
      dst.delete();
    };

    function callback() {
      let weightValue  = document.getElementById('weightValue');
      let trackbar = document.getElementById('trackbar');
      weightValue.setAttribute('value', trackbar.value);
      thresholding();
    }



</script>
<script async src="/static/opencv.js" onload="onOpenCvReady();" type="text/javascript"></script>
</body>
</html>